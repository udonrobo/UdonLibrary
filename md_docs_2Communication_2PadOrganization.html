<!-- HTML header for doxygen 1.10.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="icon" href="Udon.png" type="image/x-icon" />
<title>UdonLibrary: コントローラーの構成</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
    <div id="toc"><!-- do not remove this div, it is closed by doxygen! -->
    <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
      <div id="titlearea">
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr id="projectrow">
              <td id="projectlogo">
                <a href="https://github.com/udonrobo/UdonLibrary">
                  <img alt="Logo" src="Udon.png"  />
                </a>
              </td>
              <td id="projectalign">
                <div id="projectname">UdonLibrary<span
                    id="projectnumber">&#160;1.0.0</span>
                </div>
                <div id="projectbrief">機械システム研究部 C++ ライブラリ</div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- end header part -->
<!-- 構築: Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','検索',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_docs_2Communication_2PadOrganization.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">読み取り中…</div>
<div class="SRStatus" id="Searching">検索中…</div>
<div class="SRStatus" id="NoMatches">一致する文字列を見つけられません</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">コントローラーの構成</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md87"></a></p>
<h1><a class="anchor" id="autotoc_md88"></a>
構成を考える</h1>
<p>PS5 コントローラー は Bluetooth を用いて通信を行いますが、ロボコン会場には WiFi や Bluetooth が多く存在するため、混線する可能性があります。そこで 920MHz 帯を用いて通信します。小規模なロボットや、混線が置きにくいような環境下では Bluetooth を用いて構成することも可能です。</p>
<p>メインマイコン側のドキュメントは <a class="el" href="md_docs_2Communication_2Pad.html">こちら</a> にあります。</p>
<h2><a class="anchor" id="autotoc_md89"></a>
■ 920MHz 経由 / 無線モジュールがメイン基板にある場合 (推奨)</h2>
<div class="fragment"><div class="line">flowchart LR</div>
<div class="line">  subgraph 操縦者側</div>
<div class="line">    subgraph 送信基板</div>
<div class="line">      コントローラ --USB--&gt; USBホストシールド --SPI--&gt; 送信側マイコン[マイコン] --UART等--&gt; 送信側モジュール[無線モジュール]</div>
<div class="line">    end</div>
<div class="line">  end</div>
<div class="line">  subgraph ロボット側</div>
<div class="line">    subgraph メイン基板</div>
<div class="line">      送信側モジュール[無線モジュール] -.920MHz.-&gt; 受信側モジュール[無線モジュール] --UART等--&gt; メイン側マイコン[マイコン]</div>
<div class="line">    end</div>
<div class="line">  end</div>
</div><!-- fragment --><ul>
<li>送信基板マイコン</li>
</ul>
<h2><a class="anchor" id="autotoc_md90"></a>
■ 920MHz 経由 / 無線モジュールとメイン基板が別々の場合 (推奨)</h2>
<div class="fragment"><div class="line">flowchart LR</div>
<div class="line">  subgraph 操縦者側</div>
<div class="line">    subgraph 送信基板</div>
<div class="line">      コントローラ --USB--&gt; USBホストシールド --SPI--&gt; 送信側マイコン[マイコン] --UART等--&gt; 送信側モジュール[無線モジュール]</div>
<div class="line">    end</div>
<div class="line">  end</div>
<div class="line">  subgraph ロボット側</div>
<div class="line">    subgraph 受信基板</div>
<div class="line">      送信側モジュール[無線モジュール] -.920MHz.-&gt; 受信側モジュール[無線モジュール] --UART等--&gt; 受信側マイコン[マイコン]</div>
<div class="line">    end</div>
<div class="line">    subgraph メイン基板</div>
<div class="line">      受信側マイコン[マイコン] --CAN等--&gt; メイン側マイコン[マイコン]</div>
<div class="line">    end</div>
<div class="line">  end</div>
</div><!-- fragment --><ul>
<li>送信基板マイコン</li>
<li>受信基板マイコン</li>
</ul>
<h2><a class="anchor" id="autotoc_md91"></a>
■ Bluetooth 経由 / USB ホストシールドがメイン基板にある場合</h2>
<div class="fragment"><div class="line">flowchart LR</div>
<div class="line">  subgraph 操縦者側</div>
<div class="line">  コントローラ</div>
<div class="line">  end</div>
<div class="line">  subgraph ロボット側</div>
<div class="line">    subgraph メイン基板</div>
<div class="line">      コントローラ -.Bluetooth.-&gt; Bluetoothドングル --USB--&gt; USBホストシールド--SPI--&gt; メイン側マイコン[マイコン]</div>
<div class="line">    end</div>
<div class="line">  end</div>
</div><!-- fragment --><ul>
<li>USB ドングルとのペアリング</li>
</ul>
<h2><a class="anchor" id="autotoc_md92"></a>
■ Bluetooth 経由 / USB ホストシールドとメイン基板が別々の場合</h2>
<div class="fragment"><div class="line">flowchart LR</div>
<div class="line">  subgraph 操縦者側</div>
<div class="line">  コントローラ</div>
<div class="line">  end</div>
<div class="line">  subgraph ロボット側</div>
<div class="line">    subgraph 受信基板</div>
<div class="line">      コントローラ -.Bluetooth.-&gt; Bluetoothドングル --USB--&gt; USBホストシールド--SPI--&gt; 受信側マイコン[マイコン]</div>
<div class="line">    end</div>
<div class="line">    subgraph メイン基板</div>
<div class="line">      受信側マイコン[マイコン] --CAN等--&gt; メイン側マイコン[マイコン]</div>
<div class="line">    end</div>
<div class="line">  end</div>
</div><!-- fragment --><ul>
<li>受信基板マイコン</li>
<li>USB ドングルとのペアリング</li>
</ul>
<h2><a class="anchor" id="autotoc_md93"></a>
■ USB 経由</h2>
<div class="fragment"><div class="line">flowchart LR</div>
<div class="line">  subgraph 操縦者側</div>
<div class="line">  コントローラ</div>
<div class="line">  end</div>
<div class="line">  subgraph ロボット側</div>
<div class="line">    subgraph メイン基板</div>
<div class="line">      コントローラ --USB--&gt; USBホストシールド--SPI--&gt; メイン側マイコン[マイコン]</div>
<div class="line">    end</div>
<div class="line">  end</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md94"></a>
送信側マイコン用クラス</h1>
<p>USB ホストシールドからコントローラの情報を受け取り、無線モジュールへ <code><a class="el" href="structUdon_1_1Message_1_1PadPS5.html" title="PS5コントローラーのボタン情報">Udon::Message::PadPS5</a></code> 型オブジェクトの転送を行います。</p>
<p><code><a class="el" href="classUdon_1_1PadPS5USB.html" title="有線USB経由PS5コントローラークラス">Udon::PadPS5USB</a></code> クラスを用いることで、USB ホストシールドから <code><a class="el" href="structUdon_1_1Message_1_1PadPS5.html" title="PS5コントローラーのボタン情報">Udon::Message::PadPS5</a></code> 型オブジェクトを取得できます。<code>getMessage()</code> で取得出来ます。</p>
<div class="fragment"><div class="line"><span class="comment">// コントローラの情報を LoRa へ転送する例</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Udon_8hpp.html">Udon.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="PadPS5USB_8hpp.html">Udon/Com/Pad/PadPS5USB.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_class" href="classUdon_1_1PadPS5USB.html">Udon::PadPS5USB</a> pad;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_class" href="classUdon_1_1E220Writer.html">Udon::E220Writer&lt;Udon::Message::PadPS5&gt;</a> lora({</div>
<div class="line">    .serial = Serial1,</div>
<div class="line">    .m0 = 2,</div>
<div class="line">    .m1 = 3,</div>
<div class="line">    .aux = 4,</div>
<div class="line">    .channel = 0,</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup()</div>
<div class="line">{</div>
<div class="line">    pad.<a class="code hl_function" href="classUdon_1_1PadPS5USB.html#a6ad7186dde8c05984bc26dee2ab6694f">begin</a>();</div>
<div class="line">    lora.begin();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop()</div>
<div class="line">{</div>
<div class="line">    pad.<a class="code hl_function" href="classUdon_1_1PadPS5USB.html#a90f680e27a7b9efa2cfb8fbff2b5fee6">update</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code hl_struct" href="structUdon_1_1Message_1_1PadPS5.html">Udon::Message::PadPS5</a> message = pad.<a class="code hl_function" href="classUdon_1_1PadPS5USB.html#a88fb8fda7c42c4a19b7d1d7f12b855be">getMessage</a>();</div>
<div class="line">    lora.setMessage(message);</div>
<div class="line">    <span class="comment">// 省略形: lora.setMessage(pad.getMessage());</span></div>
<div class="line"> </div>
<div class="line">    delay(1);</div>
<div class="line">}</div>
<div class="ttc" id="aPadPS5USB_8hpp_html"><div class="ttname"><a href="PadPS5USB_8hpp.html">PadPS5USB.hpp</a></div></div>
<div class="ttc" id="aUdon_8hpp_html"><div class="ttname"><a href="Udon_8hpp.html">Udon.hpp</a></div></div>
<div class="ttc" id="aclassUdon_1_1E220Writer_html"><div class="ttname"><a href="classUdon_1_1E220Writer.html">Udon::E220Writer</a></div><div class="ttdoc">E220 送信クラス</div><div class="ttdef"><b>Definition</b> E220Writer.hpp:20</div></div>
<div class="ttc" id="aclassUdon_1_1PadPS5USB_html"><div class="ttname"><a href="classUdon_1_1PadPS5USB.html">Udon::PadPS5USB</a></div><div class="ttdoc">有線USB経由PS5コントローラークラス</div><div class="ttdef"><b>Definition</b> PadPS5USB.hpp:32</div></div>
<div class="ttc" id="aclassUdon_1_1PadPS5USB_html_a6ad7186dde8c05984bc26dee2ab6694f"><div class="ttname"><a href="classUdon_1_1PadPS5USB.html#a6ad7186dde8c05984bc26dee2ab6694f">Udon::PadPS5USB::begin</a></div><div class="ttdeci">bool begin()</div><div class="ttdoc">コントローラーと通信開始</div><div class="ttdef"><b>Definition</b> PadPS5USB.hpp:48</div></div>
<div class="ttc" id="aclassUdon_1_1PadPS5USB_html_a88fb8fda7c42c4a19b7d1d7f12b855be"><div class="ttname"><a href="classUdon_1_1PadPS5USB.html#a88fb8fda7c42c4a19b7d1d7f12b855be">Udon::PadPS5USB::getMessage</a></div><div class="ttdeci">Message::PadPS5 getMessage() const</div><div class="ttdoc">Message::PadPS5型のメッセージを取得する</div><div class="ttdef"><b>Definition</b> PadPS5USB.hpp:108</div></div>
<div class="ttc" id="aclassUdon_1_1PadPS5USB_html_a90f680e27a7b9efa2cfb8fbff2b5fee6"><div class="ttname"><a href="classUdon_1_1PadPS5USB.html#a90f680e27a7b9efa2cfb8fbff2b5fee6">Udon::PadPS5USB::update</a></div><div class="ttdeci">void update()</div><div class="ttdoc">更新</div><div class="ttdef"><b>Definition</b> PadPS5USB.hpp:61</div></div>
<div class="ttc" id="astructUdon_1_1Message_1_1PadPS5_html"><div class="ttname"><a href="structUdon_1_1Message_1_1PadPS5.html">Udon::Message::PadPS5</a></div><div class="ttdoc">PS5コントローラーのボタン情報</div><div class="ttdef"><b>Definition</b> PadPS5.hpp:21</div></div>
</div><!-- fragment --><p>コントローラに内蔵されている LED や、バイブレーションを動作させられます。</p>
<div class="fragment"><div class="line">pad.<a class="code hl_function" href="classUdon_1_1PadPS5USB.html#a5787122fc897bbefaa9500c1f2149621">setLightBar</a>({ 0x38b48b });   <span class="comment">// タッチパネルサイドLED (色指定可能)</span></div>
<div class="line">pad.<a class="code hl_function" href="classUdon_1_1PadPS5USB.html#ae7f775174a204f6ecd4bf5667c51bb6d">setMicLed</a>(<span class="keyword">true</span>);             <span class="comment">// マイクLED</span></div>
<div class="line">pad.<a class="code hl_function" href="classUdon_1_1PadPS5USB.html#acb5a8a69ef227a59356efc2c3995cccf">setPlayerLamp</a>();             <span class="comment">// タッチパネル下部LED (5つ)</span></div>
<div class="line">pad.<a class="code hl_function" href="classUdon_1_1PadPS5USB.html#ada0379f5c5ca971ca4ef2c998b0637e8">vibrate</a>(100, 100);           <span class="comment">// 左右バイブレーションモーター</span></div>
<div class="ttc" id="aclassUdon_1_1PadPS5USB_html_a5787122fc897bbefaa9500c1f2149621"><div class="ttname"><a href="classUdon_1_1PadPS5USB.html#a5787122fc897bbefaa9500c1f2149621">Udon::PadPS5USB::setLightBar</a></div><div class="ttdeci">void setLightBar(const Udon::RGB &amp;color)</div><div class="ttdoc">ライトバーの色を設定する</div><div class="ttdef"><b>Definition</b> PadPS5USB.hpp:115</div></div>
<div class="ttc" id="aclassUdon_1_1PadPS5USB_html_acb5a8a69ef227a59356efc2c3995cccf"><div class="ttname"><a href="classUdon_1_1PadPS5USB.html#acb5a8a69ef227a59356efc2c3995cccf">Udon::PadPS5USB::setPlayerLamp</a></div><div class="ttdeci">void setPlayerLamp(uint8_t mask=0b011)</div><div class="ttdoc">5つのプレイヤーのランプの点灯を設定する</div><div class="ttdef"><b>Definition</b> PadPS5USB.hpp:125</div></div>
<div class="ttc" id="aclassUdon_1_1PadPS5USB_html_ada0379f5c5ca971ca4ef2c998b0637e8"><div class="ttname"><a href="classUdon_1_1PadPS5USB.html#ada0379f5c5ca971ca4ef2c998b0637e8">Udon::PadPS5USB::vibrate</a></div><div class="ttdeci">void vibrate(uint8_t big=100, uint8_t small=100)</div><div class="ttdoc">バイブレーション</div><div class="ttdef"><b>Definition</b> PadPS5USB.hpp:140</div></div>
<div class="ttc" id="aclassUdon_1_1PadPS5USB_html_ae7f775174a204f6ecd4bf5667c51bb6d"><div class="ttname"><a href="classUdon_1_1PadPS5USB.html#ae7f775174a204f6ecd4bf5667c51bb6d">Udon::PadPS5USB::setMicLed</a></div><div class="ttdeci">void setMicLed(bool on=true)</div><div class="ttdoc">マイクのLEDの点灯を設定する</div><div class="ttdef"><b>Definition</b> PadPS5USB.hpp:132</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md95"></a>
受信側マイコン用クラス</h1>
<p>無線モジュールから取得した <code><a class="el" href="structUdon_1_1Message_1_1PadPS5.html" title="PS5コントローラーのボタン情報">Udon::Message::PadPS5</a></code> 型オブジェクトをメインマイコンへ転送します。</p>
<div class="fragment"><div class="line"><span class="comment">// LoRa で受信したデータを CAN バスへ送信する例</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Udon_8hpp.html">Udon.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_class" href="classUdon_1_1E220Reader.html">Udon::E220Reader&lt;Udon::Message::PadPS5&gt;</a> lora({</div>
<div class="line">    .serial = Serial1,</div>
<div class="line">    .m0 = 2,</div>
<div class="line">    .m1 = 3,</div>
<div class="line">    .aux = 4,</div>
<div class="line">    .channel = 0,</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_class" href="classUdon_1_1CanBusTeensy.html">Udon::CanBusTeensy&lt;CAN1&gt;</a> bus;</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_class" href="classUdon_1_1CanWriter.html">Udon::CanWriter&lt;Udon::Message::PadPS5&gt;</a> writer{ bus, 0x006 };</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup()</div>
<div class="line">{</div>
<div class="line">    lora.begin();</div>
<div class="line">    bus.<a class="code hl_function" href="classUdon_1_1E220Reader.html#a71f3992dff607d0f11b90fd2decdb2fe">begin</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop()</div>
<div class="line">{</div>
<div class="line">    bus.update();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// LoRa から CAN に転送</span></div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keyword">auto</span> message = lora.getMessage())</div>
<div class="line">    {</div>
<div class="line">        writer.setMessage(*message);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        writer.setMessage({});</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    delay(1);</div>
<div class="line">}</div>
<div class="ttc" id="aclassUdon_1_1CanBusTeensy_html"><div class="ttname"><a href="classUdon_1_1CanBusTeensy.html">Udon::CanBusTeensy</a></div><div class="ttdoc">Teensy用 CANバスクラス</div><div class="ttdef"><b>Definition</b> CanBusTeensy.hpp:31</div></div>
<div class="ttc" id="aclassUdon_1_1CanWriter_html"><div class="ttname"><a href="classUdon_1_1CanWriter.html">Udon::CanWriter</a></div><div class="ttdoc">CAN通信 送信クラス</div><div class="ttdef"><b>Definition</b> CanWriter.hpp:23</div></div>
<div class="ttc" id="aclassUdon_1_1E220Reader_html"><div class="ttname"><a href="classUdon_1_1E220Reader.html">Udon::E220Reader</a></div><div class="ttdoc">E220 受信クラス</div><div class="ttdef"><b>Definition</b> E220Reader.hpp:22</div></div>
<div class="ttc" id="aclassUdon_1_1E220Reader_html_a71f3992dff607d0f11b90fd2decdb2fe"><div class="ttname"><a href="classUdon_1_1E220Reader.html#a71f3992dff607d0f11b90fd2decdb2fe">Udon::E220Reader::begin</a></div><div class="ttdeci">void begin() noexcept</div><div class="ttdoc">受信開始</div><div class="ttdef"><b>Definition</b> E220Reader.hpp:42</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md96"></a>
Bluetooth 使用時の受信側マイコン用クラス</h1>
<p>USB ホストシールドからコントローラの情報を受け取り、<code><a class="el" href="structUdon_1_1Message_1_1PadPS5.html" title="PS5コントローラーのボタン情報">Udon::Message::PadPS5</a></code> 型オブジェクトをメインマイコンへ転送します。</p>
<p>あらかじめコントローラと Bluetooth ドングルがペアリングされている必要があります。ペアリング方法</p>
<p><code><a class="el" href="PadPS5BT_8hpp.html">PadPS5BT.hpp</a></code> を個別にインクルードし、<code><a class="el" href="classUdon_1_1PadPS5BT.html" title="Bluetooth経由PS5コントローラークラス">Udon::PadPS5BT</a></code> クラスを用います。使い方は <code>PadPS5USB</code> クラスと同じです。</p>
<div class="fragment"><div class="line"><span class="comment">// コントローラの情報を CAN バスへ転送する例</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Udon_8hpp.html">Udon.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="PadPS5BT_8hpp.html">Udon/Com/Pad/PadPS5BT.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_class" href="classUdon_1_1PadPS5BT.html">Udon::PadPS5BT</a> pad;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_class" href="classUdon_1_1CanBusTeensy.html">Udon::CanBusTeensy&lt;CAN1&gt;</a> bus;</div>
<div class="line"><span class="keyword">static</span> <a class="code hl_class" href="classUdon_1_1CanWriter.html">Udon::CanWriter&lt;Udon::Message::PadPS5&gt;</a> writer{ bus, 0x006 };</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup()</div>
<div class="line">{</div>
<div class="line">    pad.<a class="code hl_function" href="classUdon_1_1PadPS5BT.html#ad338ca40274ce971b92063d480a0e512">begin</a>();</div>
<div class="line">    bus.<a class="code hl_function" href="classUdon_1_1CanBusTeensy.html#a634246d48d846fee09ab4c3259f18b26">begin</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop()</div>
<div class="line">{</div>
<div class="line">    pad.<a class="code hl_function" href="classUdon_1_1PadPS5BT.html#a2af753f449fc60da7922b31cab218614">update</a>();</div>
<div class="line">    bus.<a class="code hl_function" href="classUdon_1_1CanBusTeensy.html#a5e0b712fc58d18f440fd3e70b2ac0100">update</a>();</div>
<div class="line"> </div>
<div class="line">    writer.setMessage(pad.<a class="code hl_function" href="classUdon_1_1PadPS5BT.html#ad31384673399f809c4d0ecae98c19162">getMessage</a>());</div>
<div class="line">}</div>
<div class="ttc" id="aPadPS5BT_8hpp_html"><div class="ttname"><a href="PadPS5BT_8hpp.html">PadPS5BT.hpp</a></div></div>
<div class="ttc" id="aclassUdon_1_1CanBusTeensy_html_a5e0b712fc58d18f440fd3e70b2ac0100"><div class="ttname"><a href="classUdon_1_1CanBusTeensy.html#a5e0b712fc58d18f440fd3e70b2ac0100">Udon::CanBusTeensy::update</a></div><div class="ttdeci">void update()</div><div class="ttdoc">バス更新</div><div class="ttdef"><b>Definition</b> CanBusTeensy.hpp:89</div></div>
<div class="ttc" id="aclassUdon_1_1CanBusTeensy_html_a634246d48d846fee09ab4c3259f18b26"><div class="ttname"><a href="classUdon_1_1CanBusTeensy.html#a634246d48d846fee09ab4c3259f18b26">Udon::CanBusTeensy::begin</a></div><div class="ttdeci">void begin()</div><div class="ttdoc">通信開始</div><div class="ttdef"><b>Definition</b> CanBusTeensy.hpp:37</div></div>
<div class="ttc" id="aclassUdon_1_1PadPS5BT_html"><div class="ttname"><a href="classUdon_1_1PadPS5BT.html">Udon::PadPS5BT</a></div><div class="ttdoc">Bluetooth経由PS5コントローラークラス</div><div class="ttdef"><b>Definition</b> PadPS5BT.hpp:31</div></div>
<div class="ttc" id="aclassUdon_1_1PadPS5BT_html_a2af753f449fc60da7922b31cab218614"><div class="ttname"><a href="classUdon_1_1PadPS5BT.html#a2af753f449fc60da7922b31cab218614">Udon::PadPS5BT::update</a></div><div class="ttdeci">void update()</div><div class="ttdoc">更新</div><div class="ttdef"><b>Definition</b> PadPS5BT.hpp:66</div></div>
<div class="ttc" id="aclassUdon_1_1PadPS5BT_html_ad31384673399f809c4d0ecae98c19162"><div class="ttname"><a href="classUdon_1_1PadPS5BT.html#ad31384673399f809c4d0ecae98c19162">Udon::PadPS5BT::getMessage</a></div><div class="ttdeci">Message::PadPS5 getMessage() const</div><div class="ttdoc">Message::PadPS5型のメッセージを取得する</div><div class="ttdef"><b>Definition</b> PadPS5BT.hpp:118</div></div>
<div class="ttc" id="aclassUdon_1_1PadPS5BT_html_ad338ca40274ce971b92063d480a0e512"><div class="ttname"><a href="classUdon_1_1PadPS5BT.html#ad338ca40274ce971b92063d480a0e512">Udon::PadPS5BT::begin</a></div><div class="ttdeci">bool begin()</div><div class="ttdoc">コントローラーと通信開始</div><div class="ttdef"><b>Definition</b> PadPS5BT.hpp:53</div></div>
</div><!-- fragment --><p><code>PadPS5USB</code> クラスと同じく、コントローラに内蔵されている LED や、バイブレーションを動作させられます。</p>
<div class="fragment"><div class="line">pad.<a class="code hl_function" href="classUdon_1_1PadPS5BT.html#a6a51b8144b41d6269556ba7324db2784">setLightBar</a>({ 0x38b48b });   <span class="comment">// タッチパネルサイドLED (色指定可能)</span></div>
<div class="line">pad.<a class="code hl_function" href="classUdon_1_1PadPS5BT.html#a72e5bbdad9c856e7c29d66c5c2cb6756">setMicLed</a>(<span class="keyword">true</span>);             <span class="comment">// マイクLED</span></div>
<div class="line">pad.<a class="code hl_function" href="classUdon_1_1PadPS5BT.html#a1506d58d8f2fa00ebc6b560e5420acce">setPlayerLamp</a>();             <span class="comment">// タッチパネル下部LED (5つ)</span></div>
<div class="line">pad.<a class="code hl_function" href="classUdon_1_1PadPS5BT.html#a1b68d42d860eb3fa3c2fbade55434e60">vibrate</a>(100, 100);           <span class="comment">// 左右バイブレーションモーター</span></div>
<div class="ttc" id="aclassUdon_1_1PadPS5BT_html_a1506d58d8f2fa00ebc6b560e5420acce"><div class="ttname"><a href="classUdon_1_1PadPS5BT.html#a1506d58d8f2fa00ebc6b560e5420acce">Udon::PadPS5BT::setPlayerLamp</a></div><div class="ttdeci">void setPlayerLamp(uint8_t mask=0b011)</div><div class="ttdoc">5つのプレイヤーのランプの点灯を設定する</div><div class="ttdef"><b>Definition</b> PadPS5BT.hpp:135</div></div>
<div class="ttc" id="aclassUdon_1_1PadPS5BT_html_a1b68d42d860eb3fa3c2fbade55434e60"><div class="ttname"><a href="classUdon_1_1PadPS5BT.html#a1b68d42d860eb3fa3c2fbade55434e60">Udon::PadPS5BT::vibrate</a></div><div class="ttdeci">void vibrate(uint8_t big=100, uint8_t small=100)</div><div class="ttdoc">バイブレーション</div><div class="ttdef"><b>Definition</b> PadPS5BT.hpp:150</div></div>
<div class="ttc" id="aclassUdon_1_1PadPS5BT_html_a6a51b8144b41d6269556ba7324db2784"><div class="ttname"><a href="classUdon_1_1PadPS5BT.html#a6a51b8144b41d6269556ba7324db2784">Udon::PadPS5BT::setLightBar</a></div><div class="ttdeci">void setLightBar(const Udon::RGB &amp;color)</div><div class="ttdoc">ライトバーの色を設定する</div><div class="ttdef"><b>Definition</b> PadPS5BT.hpp:125</div></div>
<div class="ttc" id="aclassUdon_1_1PadPS5BT_html_a72e5bbdad9c856e7c29d66c5c2cb6756"><div class="ttname"><a href="classUdon_1_1PadPS5BT.html#a72e5bbdad9c856e7c29d66c5c2cb6756">Udon::PadPS5BT::setMicLed</a></div><div class="ttdeci">void setMicLed(bool on=true)</div><div class="ttdoc">マイクのLEDの点灯を設定する</div><div class="ttdef"><b>Definition</b> PadPS5BT.hpp:142</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md97"></a>
Bluetooth ドングルとのペアリング</h1>
<p>Bluetooth を使用してコントローラのデータを取得する場合、USB ドングルとのペアリングが必要です。一度ペアリングすると以降はペアリングする必要ありません。</p>
<p><code>PadPS5BT</code> のコンストラクタに <code>PAIR</code> を指定し書き込むことで USB ドングルがペアリングモードで起動します。</p>
<div class="fragment"><div class="line"><span class="comment">// ペアリング用スケッチ</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="UdonFwd_8hpp.html">UdonFwd.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="PadPS5BT_8hpp.html">Udon/Com/Pad/PadPS5BT.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_class" href="classUdon_1_1PadPS5BT.html">Udon::PadPS5BT</a> pad{ PAIR };</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup()</div>
<div class="line">{</div>
<div class="line">    pad.<a class="code hl_function" href="classUdon_1_1PadPS5BT.html#ad338ca40274ce971b92063d480a0e512">begin</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop()</div>
<div class="line">{</div>
<div class="line">    pad.<a class="code hl_function" href="classUdon_1_1PadPS5BT.html#a2af753f449fc60da7922b31cab218614">update</a>();</div>
<div class="line">}</div>
<div class="ttc" id="aUdonFwd_8hpp_html"><div class="ttname"><a href="UdonFwd_8hpp.html">UdonFwd.hpp</a></div></div>
</div><!-- fragment --><p>クリエイトボタン、PS ボタンを長押しすることで、コントローラ側もペアリングモードになります。ペアリングモードへ移行するとライトバーが点滅します。</p>
<p>ペアリングは通常数秒で終わります。ペアリングが成功するとライトバーが点灯します。</p>
<p><img src="https://github.com/udonrobo/UdonLibrary/assets/91818705/1c66a52d-3255-4be2-87d4-8f1db863b142" alt="" width="300px" class="inline"/></p>
<blockquote class="doxtable">
<p>&zwj;ペアリングに時間がかかる場合、マイコンをリセットすることで大抵つながります。またホストシールドは電源電圧に敏感であるため、電圧値が正常か確認してください。 </p>
</blockquote>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! --></div>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript">
  DoxygenAwesomeDarkModeToggle.init()
  DoxygenAwesomeFragmentCopyButton.init()
</script>
</body>
</html>
